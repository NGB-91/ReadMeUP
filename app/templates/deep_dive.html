{% extends "base.html" %}
{% block content %}
<div class="deep-dive-container">
  <div class="model-form-container">
    <h1 class="title">Deep Dive</h1>

    <form method="POST" class="deep-dive-form" id="deep-dive-form">
      <div class="form-group">
        <textarea 
          name="query" 
          id="query"
          placeholder="Type here... Example: A thrilling mystery set in Victorian London with strong female characters"
          rows="6">{{ query }}</textarea>
      </div>

      <div class="filters-grid">
        <div class="form-group">
          <label for="language">Language</label>
          <select name="language" id="language">
            <option value="">Any Language</option>
            {% for lang in languages %}
              <option value="{{ lang }}" {% if lang == language %}selected{% endif %}>
                {{ lang }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="min_rating">
            Minimum Rating: <span id="rating_value">3.5</span>
          </label>
          <input type="range" 
                 id="min_rating" 
                 name="min_rating" 
                 min="0" 
                 max="5" 
                 step="0.1" 
                 value="3.5">
          <div class="slider-labels">
            <span>0</span>
            <span>5</span>
          </div>
        </div>

        <div class="form-group">
          <label for="top_n">
            Results: <span id="results_value">{{ top_n }}</span>
          </label>
          <input type="range" 
                 id="top_n" 
                 name="top_n" 
                 min="1" 
                 max="15" 
                 value="{{ top_n }}">
          <div class="slider-labels">
            <span>1</span>
            <span>15</span>
          </div>
        </div>
      </div>

      <button type="submit" class="submit-button">Find Books</button>
    </form>

    {% if message %}
      <div class="results-header">
        <h2 class="subtitle">Your recommendations for: {{ query }}</h2>
      </div>
    {% endif %}

    <div class="results-list">
      {% for book in results %}
        <div class="book-row">
          <div class="book-cover">
            <img src="{{ book.coverImg }}" alt="Cover of {{ book.title }}">
            {% if book.Award == True or book.Award == "True" %}
              <span class="award-icon">üèÜ</span>
            {% endif %}
          </div>
          <div class="book-details">
            <h3 class="book-title">{{ book.title }}</h3>
            <p class="book-author"><strong>Author:</strong> {{ book.author }}</p>
            <p><strong>Rating:</strong> {{ book.rating }}</p>
            <p><strong>Genres:</strong> {{ book.genres }}</p>
            <p><strong>Language:</strong> {{ book.language }}</p>
            <p><strong>Publisher:</strong> {{ book.publisher }}</p>
            <p class="book-description">{{ book.description }}</p>
          </div>
        </div>
      {% else %}
        {% if request.method == 'POST' %}
          <div class="no-results">
            <h3>No books found</h3>
            <p>Try adjusting your description or search criteria.</p>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const ratingInput = document.getElementById('min_rating');
  const resultsInput = document.getElementById('top_n');
  
  if (ratingInput) {
    ratingInput.addEventListener('input', function() {
      document.getElementById('rating_value').textContent = this.value;
    });
  }
  
  if (resultsInput) {
    resultsInput.addEventListener('input', function() {
      document.getElementById('results_value').textContent = this.value;
    });
  }
});
</script>
{% endblock %}